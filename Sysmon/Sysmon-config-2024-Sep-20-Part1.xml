<Sysmon schemaversion="4.9">
<EventFiltering>
<!--
 Process Creation
-->
    <ProcessCreate onmatch="include">
	  <!-- suspicious commandline values, u can tune and turn them into hunting rules at ur SIEM end -->
	  <CommandLine condition="contains" name="Destruction - Possible Ransomware Attack">delete shadows</CommandLine>
	  <CommandLine condition="contains" name="Destruction - Possible Ransomware Attack">bootstatuspolicy ignoreallfailures</CommandLine>
	  <CommandLine condition="contains" name="Destruction - Possible Ransomware Attack">recoveryenabled No</CommandLine>
	  <CommandLine condition="contains">shadowcopy</CommandLine>
	  <CommandLine condition="contains">-snapshot</CommandLine>
	  <CommandLine condition="contains">delete</CommandLine>
	  <CommandLine condition="contains" name="Discovery - AV Product via WMI">AntiVirusProduct</CommandLine> <!-- https://app.any.run/tasks/87a9bdd2-2eae-4394-bb01-cf205a7104c1/ -->
	  <CommandLine condition="contains" name="Discovery - Security Settings via WMI">root\SecurityCenter2</CommandLine>
	  <CommandLine condition="contains" name="Discovery - via WebShell of installed webapps">list vdir /text:physicalpath</CommandLine>
	  <CommandLine condition="contains" name="Discovery - IIS AppPools">list apppool</CommandLine>
	  <CommandLine condition="end with" name="CredAccess - Search for IIS saved apps passwords 1">/text:processmodel.password</CommandLine>
	  <CommandLine condition="end with" name="CredAccess - Search for IIS saved apps passwords 2">list vdir /text:password</CommandLine>
	  <CommandLine condition="contains" name="Defense Evasion - Change WinFW Rules">advfirewall</CommandLine><!-- e.g. open inbound RDP ports --> 
	  <CommandLine condition="contains">sysvol</CommandLine>
	  <CommandLine condition="contains">System32\drivers\etc\hosts</CommandLine>
	  <CommandLine condition="contains">HarddiskVolumeShadowCopy</CommandLine>
	  <CommandLine condition="contains">pubprn.vbs</CommandLine><!-- cscript.exe pubprn.vbs 127.0.0.1 script:http://someurl/file.sct  -->
	  <CommandLine condition="contains">scrobj.dll</CommandLine>
	  <CommandLine condition="contains">script:http</CommandLine>
	  <CommandLine condition="contains">ntds.dit</CommandLine>
	  <CommandLine condition="contains">groups.xml</CommandLine>
	  <CommandLine condition="contains"> ren </CommandLine> <!-- rename stuff --> 
	  <CommandLine condition="contains">-querytype=TXT</CommandLine><!-- could be DNS TXT C2 if too many -->
	  <CommandLine condition="contains">-decode</CommandLine><!-- certutil.exe -->
	  <CommandLine condition="contains">/format:</CommandLine><!-- execution via XSL-->
	  <CommandLine condition="contains">/node:</CommandLine><!-- remote wmic -->
	  <CommandLine condition="contains">-urlcache</CommandLine> <!-- certutil download -->
	  <CommandLine condition="end with" name="Execution - Excel DDE">EXCEL.EXE" /dde</CommandLine><!-- https://app.any.run/tasks/60700042-753e-4f5f-814c-5297d8423cc2/ -->
	  <CommandLine condition="contains">LaunchINFSection</CommandLine><!-- https://securelist.com/muddywater/88059/ -->
	  <CommandLine condition="contains">InstallHinfSection</CommandLine> <!-- rundll32.exe setupapi.dll,InstallHinfSection DefaultInstall 128 c:\path to file.inf  -->
	  <CommandLine condition="contains" name="Execution - HTA via rundll32">RunHTMLApplication</CommandLine> <!-- https://app.any.run/tasks/e228af54-49dc-4c64-86b4-25b461567893/ -->
	  <CommandLine condition="contains">javascript:</CommandLine>
	  <CommandLine condition="contains">SHCreateLocalServerRunDll</CommandLine><!-- https://twitter.com/menasec1/status/1106687936093925376 -->
	  <CommandLine condition="contains">passw</CommandLine>
	  <CommandLine condition="contains"> administrator </CommandLine><!-- do not remove the spaces -->
	  <CommandLine condition="contains">portproxy</CommandLine>
	  <CommandLine condition="contains">listena</CommandLine><!-- netsh portproxy listenaddress -->
      <CommandLine condition="contains">admin$</CommandLine>
	  <CommandLine condition="contains">c$</CommandLine>
	  <CommandLine condition="contains">\\</CommandLine>
	  <CommandLine condition="contains">ScriptFile=</CommandLine>
	  <CommandLine condition="contains">.csproj</CommandLine>
	  <CommandLine condition="contains" name="Discovery - domain time"> time </CommandLine>
	  <CommandLine condition="contains">..\..\</CommandLine>
	  <CommandLine condition="contains">::</CommandLine><!-- mimikatz like cmdline -->
	  <CommandLine condition="contains">2>nul</CommandLine>
	  <CommandLine condition="contains">/extract:</CommandLine><!-- wusa.exe cmd to extract stuff to a desired location -->
	  <CommandLine condition="contains">sekurlsa</CommandLine>
	  <CommandLine condition="contains">privilege::debug</CommandLine>
	  <CommandLine condition="contains">dcsync</CommandLine>
	  <CommandLine condition="contains">^</CommandLine>
	  <CommandLine condition="contains">127.0.0</CommandLine>
	  <CommandLine condition="contains">file://</CommandLine>
	  <!-- https://bohops.com/2018/02/10/vshadow-abusing-the-volume-shadow-service-for-evasion-persistence-and-active-directory-database-extraction/ -->
	  <CommandLine condition="contains">-nw -exec=</CommandLine><!-- vshadow -->
	  <CommandLine condition="contains">-p -nw</CommandLine><!-- vshadow -->
	  <CommandLine condition="contains"></CommandLine>
	  <CommandLine condition="contains" name="Suspicious Cmdline - Pipe">\pipe\</CommandLine>
	  <CommandLine condition="contains" name="Suspicious Cmdline - MsAccess MACRO Exec">/x Macro</CommandLine>
	  <CommandLine condition="contains" name="Suspicious Cmdline - RDP Port">/noprofile</CommandLine>
	  <CommandLine condition="contains">3389</CommandLine>
	  <CommandLine condition="contains">control.exe /name</CommandLine>
      <CommandLine condition="contains">-ma lsass.exe</CommandLine>
      <CommandLine condition="contains" name="Execution - rundll32 suspicious Control_RunDLL">Control_RunDLL</CommandLine>
	  <CommandLine condition="contains" name="Execution - rundll32 suspicious ShellExec_RunDLL">ShellExec_RunDLL</CommandLine>
      <CommandLine condition="contains">DisableIOAVProtection</CommandLine>
      <CommandLine condition="contains">RemoveDefinitions</CommandLine>
      <CommandLine condition="contains">/logfile= /LogToConsole=false /U</CommandLine>
	  <Product>Player (1.0.0.0)</Product> <!-- https://analyze.intezer.com/#/analyses/6e5d8dad-0097-4e9a-bca0-f608c047557c -->
      <CommandLine condition="contains">Add-MpPreference</CommandLine>
	  <CommandLine condition="contains">list apppool /text:</CommandLine>
	  <CommandLine condition="contains">%appdata%</CommandLine><!-- add later more env variables -->
	  <CommandLine condition="contains">%comspec%</CommandLine>
	  <CommandLine condition="contains">%TEMP%</CommandLine>
	  <!-- windows IIS server utility - https://blog.netspi.com/decrypting-iis-passwords-to-break-out-of-the-dmz-part-2/ -->
	  <Image condition="end with">appcmd.exe</Image> <!-- legit IIS utility, can be used to change IIS sensitive config settings --> 
	  <Description>Application Server Command Line Admin Tool</Description> <!-- desc of appcmd.exe -->
	  <!-- suspicious PE extensions -->
	  <Image condition="end with">.tmp</Image>
	  <Image condition="end with">.dat</Image>
	  <Image condition="end with">.jpg</Image>
	  <Image condition="end with">.png</Image>
	  <Image condition="end with">.inf</Image>
	  <!-- DLL Side Loading - BYOV -->
	  <Hashes condition="contains">4D160E93273AC909FE2AA0EE9D25C905DEC43082</Hashes> <!-- credwiz.exe https://app.any.run/tasks/3fcfd265-ef80-4749-a24b-39364a079802 -->
	  <Hashes condition="contains">4e1e0b8b0673937415599bf2f24c44ad</Hashes><!-- signed McAfee binary filename: mcvsmap.ex -->
	  <Hashes condition="contains">884d46c01c762ad6ddd2759fd921bf71</Hashes><!-- Signed McAfee binary for sideloading mcf.exe-->
	  <Hashes condition="contains">e26d04cecd6c7c71cfbb3f335875bc31</Hashes><!-- Valid, signed Kaspersky binary avp.exe -->
	  <Hashes condition="contains">09b8b54f78a10c435cd319070aa13c28</Hashes><!-- Legitimate, signed Nvidia executable Nv.exe-->
	  <Hashes condition="contains">0d58e5f4e82539de38ba7f9b4a8dda12</Hashes><!--Legitimate, signed Intel binary hkcmd.exe --> 
	  <Hashes condition="contains">8ddc664747b4c424c4ed576362134f3c</Hashes><!-- Legitimate Samsung application RunHelp.exe -->
	  <Hashes condition="contains">ce2ae795117e54ca8403f86e7a3e19a7</Hashes><!-- vulnerable to DLL side loading - DNS Benchmark Utility -->
	  <Hashes condition="contains">d9978f95ce30e85943efb52c9c7d731b</Hashes><!-- Lenovoâ€™s ThinkPad Display Utility tplcdclr.exe -->
      <Hashes condition="contains">9d0da088d2bb135611b5450554c99672</Hashes><!-- Valid, signed Veetle TV Player binary VeetlePlayer.exe -->	  
	  <Hashes condition="contains">9d0da088d2bb135611b5450554c99672</Hashes><!--Valid, signed Veetle TV Player binary VeetlePlayer.exe -->
	  <Hashes condition="contains">ffb84b8561e49a8db60e0001f630831f</Hashes> <!-- DLL side loading via vulnerable chrome program chrome_frame_helper.exe-->
      <!-- Some of the known dangerous COM classes used for lateral mvmt and execution 
	  - https://twitter.com/menasec1/status/1106687936093925376
	  - https://bohops.com/2018/08/18/abusing-the-com-registry-structure-part-2-loading-techniques-for-evasion-and-persistence/
	  - https://www.cybereason.com/blog/dcom-lateral-movement-techniques
	  - https://fr.slideshare.net/PhilipTsukerman/sneaking-past-device-guard-137929462
	  -->
      <CommandLine condition="contains" name="DCOM - Excel.Application">{00020812-0000-0000-C000-000000000046}</CommandLine> 	  
 	  <CommandLine condition="contains" name="DCOM - Word.Application">{00020906-0000-0000-C000-000000000046}</CommandLine>
	  <CommandLine condition="contains" name="DCOM - Powerpoint.Application">{048EB43E-2059-422F-95E0-557DA96038AF}</CommandLine>
	  <CommandLine condition="contains" name="DCOM - Outlook.Application">{0006F04A-0000-0000-C000-000000000046}</CommandLine> <!-- -->
	  <CommandLine condition="contains" name="DCOM - Visio.Application">{00021A20-0000-0000-C000-000000000046}</CommandLine> <!-- -->
	  <CommandLine condition="contains" name="DCOM - ShellWindows">9BA05972-F6A8-11CF-A442-00A0C90A8F39</CommandLine> <!-- -->
	  <CommandLine condition="contains" name="DCOM - ShellBrowserWindow">{c08afd90-f2a1-11d1-8455-00a0c91f3880}</CommandLine> <!-- -->
	  <CommandLine condition="contains" name="DCOM - MMC20.APPLICATION">{7e0423cd-1119-0928-900c-e6d4a52a0715}</CommandLine> <!-- -->
	  <CommandLine condition="contains" name="DCOM - HTML Application">{40AEEAB6-8FDA-41e3-9A5F-8350D4CFCA91}</CommandLine> <!-- -->
	  <CommandLine condition="contains" name="DCOM - WScript.Shell">{72C24DD5-D70A-438B-8A42-98424B88AFB8}</CommandLine> <!-- -->
	  <CommandLine condition="contains" name="DCOM - Shell.Application">{13709620-C279-11CE-A49E-444553540000}</CommandLine> <!-- -->
	  <CommandLine condition="contains" name="DCOM - Background Intelligent Transfer Control Class 1.0">{4991d34b-80a1-4291-83b6-3328366b9097}</CommandLine>
	  <CommandLine condition="contains" name="Execution - Suspicious Cmdline - JScript Engine CLSID">{cc5bbec3-db4a-4bed-828d-08d78ee3e1ed}</CommandLine>
	  <CommandLine condition="contains" name="Execution - Unusual Scripting Engine in use - jscript9.dll">{16d51579-a30b-4c8b-a276-0ff4dc41e755}</CommandLine>
	  <CommandLine condition="contains" name="Execution - Unusual Scripting Engine in use - chakra.dll">{1b7cd997-e5ff-4932-a7a6-2a9e636da385}</CommandLine>
	  <CommandLine condition="contains" name="Possible Lateral Movmt via Excel.Application DCOM">EXCEL.EXE" /automation -Embedding</CommandLine>
	  <CommandLine condition="contains" name="Possible Lateral Movmt via Word.Application DCOM">WINWORD.EXE" /automation -Embedding</CommandLine>
	  <CommandLine condition="contains" name="Possible Lateral Movmt via Access.Application DCOM">MSACCESS.EXE" -Embedding</CommandLine>
	  <CommandLine condition="contains" name="Possible Lateral Movmt via Powerpoint.Application DCOM">POWERPNT.EXE" /AUTOMATION -Embedding</CommandLine>
	  <CommandLine condition="contains" name="Possible Lateral Movmt via Outlook.Application DCOM">OUTLOOK.EXE" -Embedding</CommandLine>
	  <!-- Macro and Office CVEs stuff -->
	  <ParentImage condition="image">excel.exe</ParentImage>
	  <ParentImage condition="image">winword.exe</ParentImage>
	  <ParentImage condition="image">powerpnt.exe</ParentImage>
	  <ParentImage condition="image">outlook.exe</ParentImage>
	  <ParentImage condition="image">msaccess.exe</ParentImage>
	  <ParentImage condition="image">mspub.exe</ParentImage>
	  <ParentImage condition="image" name="Exploit - Equation Editor starts application CVE-2017-11882">EQNEDT32.EXE</ParentImage> <!-- https://app.any.run/tasks/dfea0112-6fbe-4091-9161-1e8f25f611b0/-->
	  <Image condition="image" name="Exploit - EPS processing CVE-2017-0261">FLTLDR.EXE</Image><!-- https://app.any.run/tasks/481000c0-985a-4cf2-936e-e090e4e22ebc/ -->
	  <!-- files and folders manipulation -->
	  <CommandLine condition="contains">mklink</CommandLine>
	  <Image condition="image">icacls.exe</Image> <!-- change file permissions -->
	  <Image condition="image">xcopy.exe</Image> <!-- data staging -->
	  <Image condition="image">robocopy.exe</Image> <!-- data staging -->
	  <Image condition="image">forfiles.exe</Image> <!-- multi or recursive files handling -->
	  <CommandLine condition="contains">copy</CommandLine><!-- data staging -->
	  <CommandLine condition="contains">delete</CommandLine><!-- data staging -->
	  <Image condition="image">attrib.exe</Image> <!-- hide files -->
	  <Image condition="image">takeown.exe</Image> <!-- change files ownership  -->
	  <Image condition="image">makecab.exe</Image>
	  <Description>LZ Expansion Utility</Description><!-- used to decompress .cab files -->
	  <Image condition="image">wusa.exe</Image><!-- can be used to extract files to protected paths or to unistall specific security patches -->
	  <CommandLine condition="contains">mklink</CommandLine> <!-- symlink -->
	  <Image condition="image">vssadmin.exe</Image><!-- often abused by ransomwares to prevent restoring  https://app.any.run/tasks/eb357755-c804-4d50-8d1b-7693cd68584f/ -->
	  <!-- windows discovery utilities-->
	  <CommandLine condition="contains">/query /tn</CommandLine>
	  <Image condition="image">csc.exe</Image><!-- delete me -->
	  <Image condition="image">systeminfo.exe</Image>
	  <Image condition="image">where.exe</Image>
	  <Image condition="image">findstr.exe</Image>
	  <Image condition="image">find.exe</Image>	  
	  <Image condition="image">route.exe</Image>
	  <Image condition="image">tracert.exe</Image>
	  <Image condition="image">ipconfig.exe</Image>
	  <Image condition="image">quser.exe</Image>
      <Image condition="image">query.exe</Image>
	  <Image condition="image">qwinsta.exe</Image>
	  <Image condition="image">cmdkey.exe</Image>
	  <Image condition="image">qprocess.exe</Image>
	  <Image condition="image">rwinsta.exe</Image>
	  <Image condition="image">nbtstat.exe</Image>
      <Image condition="image">klist.exe</Image>
	  <Image condition="image">reg.exe</Image>
	  <Image condition="image">tree.com</Image>
	  <Description condition="contains">Registry Console Tool</Description>
	  <Image condition="image">tasklist.exe</Image>
      <Image condition="image">sysinfo.exe</Image>
      <Image condition="image">nslookup.exe</Image>
	  <Image condition="image">netstat.exe</Image>
      <Image condition="image">whoami.exe</Image>
	  <Image condition="image">cmdkey.exe</Image>
	  <Description condition="contains">Net Command</Description><!-- avoid missing renamed net.exe -->
	  <Image condition="image">netsh.exe</Image>
	  <Product condition="contains">PsLoggedon</Product><!-- sysinternal - recon of active logon sessions remote and local-->
	  <Product condition="end with">AccessChk</Product><!-- sysinternal - used to assess weak permissions-->
	  <!-- windows lateral movement utilities -->
	  <Hashes condition="end with" name="plink.exe 64b imphash matched">87AECF008D87EC86EC8B00A2394B3E6C</Hashes>
	  <Hashes condition="end with" name="plunk.exe 32b imphash matched">FB3F0D0DE8B80EA8CFAB2A025EC6B833</Hashes>
	  <Hashes condition="end with" name="putty.exe 64b imphash matched">F4067FBF7FFF6945D0BB485B727B39AA</Hashes>
	  <Product name="Putty utility detected">PuTTY suite</Product>
	  <Image condition="image">winrshost.exe</Image><!-- WinRM's Remote Shell  -->
	  <ParentImage condition="end with">winrshost.exe</ParentImage><!-- WinRM's Remote Shell children processes -->
	  <Image condition="image" name="Lateral Movement - Windows Remote Management">wsmprovhost.exe</Image>
	  <ParentImage condition="image" name="Lateral Movement - Windows Remote Management">wsmprovhost.exe</ParentImage>
	  <ParentImage condition="image" name="process launched via WMI">wmiprvse.exe</ParentImage><!-- WMI local and remote -->
	  <ParentCommandLine name="Process Launched via DCOM">C:\WINDOWS\system32\svchost.exe -k DcomLaunch</ParentCommandLine><!-- usual ones are excluded to reduce the noise -->
	  <Image condition="image">winrm.cmd</Image>
	  <Image condition="image">winrs.exe</Image>
	  <Product condition="end with">PsExec</Product><!-- sysinternal - psexec for remote execution-->
	  <Image condition="image">runas.exe</Image>
	  <Image condition="image">psexecsvc.exe</Image>
	  <ParentImage condition="end with">psexecsvc.exe</ParentImage>
	  <Image condition="image">net1.exe</Image>
	  <Product condition="end with">PsPasswd</Product><!-- Sysinternal - PsPasswd changes passwords on a local or remote system. -->
	  <Product condition="end with">ShellRunAs</Product><!-- Sysinternal - Run as different user local or remote -->
	  <CommandLine condition="contains">/netonly</CommandLine><!-- runas or shellrunas with /netonly option, will capture also renamed ones --> 
	  <Description condition="end with">Rlogin client</Description><!-- Putty Plink description-->
	  <ParentCommandLine name="Remote Registry Activity">C:\WINDOWS\system32\svchost.exe -k localService -s RemoteRegistry</ParentCommandLine>
	  <ParentCommandLine>C:\Windows\System32\svchost.exe -k termsvcs</ParentCommandLine> <!-- RDP Stuff -->
	  <ParentCommandLine>c:\windows\system32\svchost.exe -k netsvcs -s Appinfo</ParentCommandLine> <!-- can be useful for tokens manip detection -->
	  <ParentCommandLine>C:\Windows\system32\svchost.exe -k iissvcs</ParentCommandLine> <!-- to track any unexpected chil process of IIS service other than w3wp.exe or alike -->
	  <!-- Known UAC Bypass related processes -->
	  <Image condition="image">sdclt.exe</Image>
	  <Image condition="image">mcx2prov.exe</Image>
	  
	  
	  <!-- initial access and execution - LolBins -->
	  <Product>Command Line XSLT</Product> <!-- msxsl.exe -->
	  <Image condition="image">msxsl.exe</Image> <!-- msxsl.exe -->
	  <Image condition="image">wmic.exe</Image>
	  <ParentImage condition="image">wmic.exe</ParentImage>
	  <Description>WMI Commandline Utility</Description>
	  <Hashes condition="end with">2ADD819314DB805510C4061EE44504C2</Hashes> <!-- imphash of msxsl.exe -->
	  <Image condition="image">bitsadmin.exe</Image>
	  <Description condition="contains">BITS administration utility</Description><!-- to detect renamed ones -->
	  <Image condition="image">certutil.exe</Image>
	  <Description>CertUtil.exe</Description>
	  <CommandLine>"C:\Program Files\Common Files\Microsoft Shared\EQUATION\EQNEDT32.EXE" -Embedding</CommandLine><!-- -->
	  <Description condition="contains">WMI Commandline Utility</Description><!-- to detect renamed wmic -->
	  <Image condition="image">cscript.exe</Image>
	  <Product condition="end with">Windows Script Host</Product><!-- both cscript and wscript end with this string -->
      <Image condition="image">wscript.exe</Image>
      <Image condition="image">powershell.exe</Image>
	  <Description>Windows PowerShell</Description>
	  <Description>Microsoft Application Virtualization Injector</Description>
      <Image condition="image">Mavinject.exe</Image>
      <Image condition="image">regsvcs.exe</Image>
	  <Image condition="image">rundll32.exe</Image>
	  <Image condition="image">javaw.exe</Image>
	  <Image condition="image">javaws.exe</Image>
	  <ParentImage condition="end with">rundll32.exe</ParentImage>	  
      <Image condition="image">mshta.exe</Image>
	  <Description condition="end with">HTML Application host</Description>
      <Image condition="image">MSBuild.exe</Image>
	  <Image condition="image">hh.exe</Image>
	  <Image condition="image">CMSTP.exe</Image> <!-- cmstp.exe /s file.inf -->
	  <Description condition="end with">Manager Profile Installer</Description>
	  <Image condition="image">sdbinst.exe</Image>
	  <Description>Application Compatibility Database Installer</Description>
      <Image condition="image">regasm.exe</Image>
	  <Description>Microsoft .NET Assembly Registration Utility</Description>
	  <Image condition="image">vbcscompiler.exe</Image>
	  <Image condition="image">jjs.exe</Image> <!-- https://blog.ensilo.com/uncovering-new-activity-by-apt10 -->
	  <ParentImage condition="image">jjs.exe</ParentImage> <!-- https://blog.ensilo.com/uncovering-new-activity-by-apt10 -->
      <Image condition="image">cmd.exe</Image>
	  <Description>Windows Command Processor</Description>
      <Image condition="image">InstallUtil.exe</Image>
      <Image condition="image">regsvr32.exe</Image>
	  <ParentImage condition="image">regsvr32.exe</ParentImage>
	  <Description>Microsoft(C) Register Server</Description> <!-- regsvr32 -->
      <Image condition="image">odbcconf.exe</Image>
	  <Image condition="image">rundll32.exe</Image>
      
      <!-- suspicious paths -->
	  <!-- add this stuff https://github.com/MicrosoftDocs/windows-itpro-docs/blob/master/windows/security/threat-protection/windows-defender-application-control/microsoft-recommended-block-rules.md -->

      <Image condition="begin with" name="suspicious execution path">C:\Users\NetworkService\</Image>
	  <Image condition="contains" name="suspicious execution path">HarddiskVolumeShadowCopy</Image>
	  <Image condition="begin with" name="suspicious execution path">C:\Users\Default\</Image>
	  <Image condition="begin with" name="suspicious execution path">C:\Users\Public\</Image>
	  <Image condition="begin with" name="suspicious execution path">C:\Users\administrator\</Image>
	  <Image condition="begin with" name="suspicious execution path">C:\Users\Guest\</Image>
	  <Image condition="contains" name="suspicious execution path">\administrateur\</Image><!-- for french speaking people -->
	  <Image condition="begin with" name="suspicious execution path">C:\Windows\Media\</Image>
      <Image condition="begin with" name="suspicious execution path">C:\Windows\addins\</Image>
	  <Image condition="contains" name="suspicious execution path">tsclient\</Image>
	  <Image condition="contains" name="suspicious execution path">\htdocs\</Image>
	  <Image condition="begin with" name="suspicious execution path">C:\Windows\system32\config\systemprofile\</Image>
	  <Image condition="begin with" name="suspicious execution path">C:\PerfLogs\</Image>
	  <Image condition="begin with" name="suspicious execution path">c:\windows\ServiceProfiles\</Image>
	  <Image condition="begin with" name="suspicious execution path">C:\Intel\Logs\</Image>
      <Image condition="begin with" name="suspicious execution path">C:\Windows\repair\</Image>
	  <Image condition="begin with" name="suspicious execution path">C:\Windows\Help\</Image>
	  <Image condition="begin with" name="suspicious execution path">C:\$Recycle.bin\</Image>
	  <Image condition="begin with" name="suspicious execution path">C:\Windows\Debug\</Image>
	  <Image condition="begin with" name="suspicious execution path">C:\Windows\security\</Image>
      <Image condition="begin with" name="suspicious execution path">C:\Windows\Fonts\</Image>
	  <Image condition="contains" name="suspicious execution path">\wwwroot\</Image>
	  <Image condition="begin with">C:\Users\</Image><!-- disable this one if too noisy, it's recommended to have good visibility on execs from all user's profiles then u exclude ur own env legit stuff -->
	  <CommandLine condition="contains" name="Execution - from compressed archive">\AppData\Local\Temp\Rar$</CommandLine><!-- exec from winrar -->
	  <CommandLine condition="contains" name="Execution - from compressed archive">AppData\Local\Temp\7z</CommandLine><!-- exec from 7zip -->
	  <CommandLine condition="contains" name="Execution - from compressed archive">AppData\Local\Temp\Temp1_</CommandLine><!-- exec from explorer -->
      <!-- defense evasion and anti-forensics -->
	  <Description condition="end with">fsutil.exe</Description><!-- Delete a USN journal using fsutil -->
	  <Hashes condition="end with">F83AF696085721D3C56BF406B1CA5AF2</Hashes><!-- imphash of fsutil -->
	  <Product condition="end with">ProcDump</Product><!-- dump remote process memory -->
	  <Product condition="end with">PsSuspend</Product><!-- suspend remote process memory -->
	  <Image condition="image">MpCmdRun.exe</Image><!-- Configure and manage Windows Defender -->
	  <Image condition="image">wbadmin.exe</Image><!-- deleting backdup catalog prevent system from restoring, can be used by ransomwares -->
	  <CommandLine condition="contains" name="WinDefender tampering">-RemoveDefinitions</CommandLine><!-- Restores the installed Security intelligence to a previous backup copy or to the original default set-->
	  <CommandLine condition="contains" name="WinDefender tampering">-RemoveDynamicSignature</CommandLine><!-- Removes dynamic Security intelligence -->
	  <Image condition="image">wevtutil.exe</Image>
	  <Description condition="begin with">Eventing Command Line</Description>
      <Image condition="image">taskkill.exe</Image>
	  <Image condition="image">timeout.exe</Image> <!-- to delay exec -->
	  <Image condition="image">bcdedit.exe</Image> <!-- to delay exec -->
	  <Description condition="contains">Boot Configuration Data Editor</Description><!-- edit boot config data to allow bypass of low level sys protection -->
	  <CommandLine condition="contains">drivers\etc\hosts</CommandLine><!-- attempts to edit local dns file --> 
	  <CommandLine condition="contains">clear-log</CommandLine><!-- take care of the logs -->
	  <CommandLine condition="contains">.evtx </CommandLine> <!-- offline evtx files manipulation -->
	  <CommandLine condition="contains">cl Security</CommandLine> <!-- clear logs -->
	  <CommandLine condition="contains">cl Application</CommandLine><!-- clear logs -->
	  <CommandLine condition="contains">cl System</CommandLine><!-- clear logs -->
	  <CommandLine condition="contains">deletejournal</CommandLine><!-- Delete a USN journal using fsutil -->
	  <Image condition="image">SyncAppvPublishingServer.exe</Image><!--applocker-bypass-->
	  <!-- abnormal or a must to see child processes -->
	  <ParentImage condition="image">cmd.exe</ParentImage>
      <ParentImage condition="image">utilman.exe</ParentImage>
      <ParentImage condition="image">DisplaySwitch.exe</ParentImage>
      <ParentImage condition="image">sethc.exe</ParentImage>
      <ParentImage condition="image">mshta.exe</ParentImage>
      <ParentImage condition="image">control.exe</ParentImage>
      <ParentImage condition="image">pcalua.exe</ParentImage>
      <ParentImage condition="image">fodhelper.exe</ParentImage>
	  <ParentImage condition="image">lsass.exe</ParentImage>
	  <ParentImage condition="image">rundll32.exe</ParentImage>
	  <ParentImage condition="image">powershell.exe</ParentImage>
	  <ParentImage condition="image">wmic.exe</ParentImage>
      <ParentImage condition="image">eventvwr.exe</ParentImage> <!-- if not mmc.exe then it's a UAC bypass -->
      <ParentImage condition="image">osk.exe</ParentImage>
      <ParentImage condition="image">powershell.exe</ParentImage>
      <ParentImage condition="image">powershell_ise.exe</ParentImage>
      <ParentImage condition="image">cscript.exe</ParentImage>
      <ParentImage condition="image">Magnify.exe</ParentImage>
      <ParentImage condition="image">AtBroker.exe</ParentImage>
      <ParentImage condition="image">Narrator.exe</ParentImage>
      <ParentImage condition="image">wscript.exe</ParentImage>
	  <ParentImage condition="image">taskhostw.exe</ParentImage><!-- normally taskhostw and taskhost has no child processes -->
	  <ParentImage condition="image">spoolsv.exe</ParentImage>
	  <!-- WebShell Stuff -->
	  <ParentImage condition="image">w3wp.exe</ParentImage> <!-- at your SIEM side exclude legit child processes -->
	  
	  <!-- Persistence stuff -->
	  <Image condition="image" name="Persistence or Exec - Services Management">sc.exe</Image>
	  <ParentCommandLine>c:\windows\system32\svchost.exe -k netsvcs -s BITS</ParentCommandLine> <!-- bitsadmin persistence -->
	  <Description>Service Control Manager Configuration Tool</Description>
	  <Image condition="image" name="Persistence - Scheduled Task Management">schtasks.exe</Image>
	  <Description name="renamed">Task Scheduler Configuration Tool</Description>
	  <Image condition="image" name="Persistence - Scheduled Task Management AT">at.exe</Image><!-- scheduled task -->
	  <Description name="Persistence or Exec - Services Management">Schedule service command line interface</Description>
	  <ParentCommandLine name="Persistence - Scheduled Task -Schedule">c:\windows\system32\svchost.exe -k netsvcs -s Schedule</ParentCommandLine><!-- scheduled tasks -->
	  <ParentImage condition="image" name="Persistence - Scheduled Task taskeng">taskeng.exe</ParentImage><!-- scheduled task -->
	  <Image name="Persistence or Exec - ActiveScriptConsumer">C:\WINDOWS\system32\wbem\scrcons.exe</Image><!-- WMI ActiveScript Event Consumer persistence -->
	  <ParentImage name="Persistence or Exec - ActiveScriptConsumer">C:\WINDOWS\system32\wbem\scrcons.exe</ParentImage><!-- WMI ActiveScript Event Consumer persistence -->
	  <ParentImage condition="image" name="Persistence - Service">services.exe</ParentImage>
	  <Image condition="image">mofcomp.exe</Image>
	  <Image condition="image">sdbinst.exe</Image>
    </ProcessCreate>
	
	<!-- ProcessCreate - Exclusion Section -->
	
    <ProcessCreate onmatch="exclude">
	  <Image condition="image">dllhost.exe</Image>
	  <!-- some of the observed default windows scheduled tasks -->
	  <Image condition="begin with">C:\Windows\Microsoft.NET\Framework64</Image>
	  <Image>C:\Program Files\Oracle\VirtualBox\VBoxNetDHCP.exe</Image>
	  <!-- legit child proc of DCOM svchost -->
	  <Image>C:\Windows\System32\TSTheme.exe</Image>
	  <Image>C:\Windows\System32\ThumbnailExtractionHost.exe</Image>
	  <Image>C:\Windows\CCM\UpdateTrustedSites.exe</Image>
	  <Image>C:\Windows\System32\drvinst.exe</Image>
	  <Image>C:\Windows\servicing\TrustedInstaller.exe</Image>
	  <Image>C:\Windows\System32\msdtc.exe</Image>
	  <Image>C:\Windows\system32\dgagent\DSAGENT.exe</Image>
	  <Image>C:\Windows\system32\inetsrv\inetinfo.exe</Image>
	  <CommandLine condition="contains">{FCC74B77-EC3E-4DD8-A80B-008A702075A9}</CommandLine> <!--  ARP UninstallString Launcher -->
	  <CommandLine condition="contains">{06622D85-6856-4460-8DE1-A81921B41C4B}</CommandLine> <!-- COpenControlPanel -->
	  <Hashes>88F5B8A224E2F6213BCEF481DFF428B6</Hashes><!-- imphash of efsui.exe legit child processes of lsass.exe -->
	  <Hashes name="Defense Evasion - Vshadow Utility Detected">DFCA9A022C377F6802C040154483A3DC</Hashes><!-- vshadow imphash -->
	  <!-- need to add this https://bohops.com/2018/03/26/diskshadow-the-return-of-vss-evasion-persistence-and-active-directory-database-extraction/ -->
	  <Hashes condition="end with">6199B3F7B851154BC163FE8A178B52CD</Hashes><!-- imphash of legit win service wsqmcons.exe -->
	  <Hashes condition="end with">22D77044B3E52A4CCC4DCA465FED7788</Hashes><!-- imphash of OneDriveStandaloneUpdater.exe scheduled task -->
	  <Hashes condition="end with">5165B87065EF64A7147F2048047DE6E4</Hashes><!-- imphash of Office Telemetry Agent scheduled task -->
	  <Hashes condition="end with">30B445BBF8A14DC88FF7969FB2D55AEA</Hashes><!-- imphash of wifitask scheduled task -->
	  <Hashes condition="end with">7DF1816239C5BC855600D41210406C5B</Hashes><!-- imphash of GoogleUpdate.exe scheduled task -->
	  <Hashes condition="end with">A24508508C276AB05C01E4965878D2F9</Hashes><!-- imphash of wlms -->
	  <Hashes condition="end with">97D183ECFE4443760A9F4C1A07F4A03E</Hashes><!-- Application Impact Telemetry Agent -->
	  <CommandLine>C:\Windows\system32\svchost.exe -k apphost</CommandLine>
	  <CommandLine>C:\Windows\System32\spoolsv.exe</CommandLine>
	  <CommandLine>"C:\Windows\System32\regsvr32.exe" /s /n /i:U shell32.dll</CommandLine>
	  <CommandLine>C:\Windows\system32\wbem\unsecapp.exe -Embedding</CommandLine>
	  <CommandLine>C:\WINDOWS\system32\rundll32.exe /d acproxy.dll,PerformAutochkOperations</CommandLine>
      <CommandLine>C:\WINDOWS\system32\devicecensus.exe</CommandLine>
	  <CommandLine>C:\Windows\System32\sdclt.exe /CONFIGNOTIFICATION</CommandLine>
      <CommandLine>C:\WINDOWS\system32\AppHostRegistrationVerifier.exe</CommandLine>
      <CommandLine>C:\WINDOWS\system32\rundll32.exe dfdts.dll,DfdGetDefaultPolicyAndSMART</CommandLine>
      <CommandLine condition="contains">NGenTask.exe" /RuntimeWide /StopEvent:</CommandLine>
	  <CommandLine condition="begin with">"C:\Windows\system32\mmc.exe" "C:\Windows\system32\</CommandLine>
      <CommandLine>C:\WINDOWS\system32\cleanmgr.exe /autoclean /d C:</CommandLine>
      <CommandLine>C:\WINDOWS\system32\dstokenclean.exe</CommandLine>
      <CommandLine>C:\WINDOWS\system32\disksnapshot.exe -z</CommandLine>
      <CommandLine>C:\WINDOWS\system32\rundll32.exe Startupscan.dll,SusRunTask</CommandLine>
      <CommandLine>C:\WINDOWS\system32\lpremove.exe</CommandLine>
      <CommandLine>C:\WINDOWS\system32\rundll32.exe Windows.Storage.ApplicationData.dll,CleanupTemporaryState</CommandLine>
      <CommandLine>C:\WINDOWS\system32\appidcertstorecheck.exe</CommandLine>
      <CommandLine>gpupdate.exe /target:computer</CommandLine>
      <CommandLine>C:\WINDOWS\system32\usoclient.exe StartScan</CommandLine>
      <CommandLine>C:\WINDOWS\System32\sihclient.exe</CommandLine>
      <CommandLine>C:\WINDOWS\system32\rundll32.exe sysmain.dll,PfSvWsSwapAssessmentTask</CommandLine>
      <CommandLine>C:\WINDOWS\system32\ClipRenew.exe</CommandLine>
      <CommandLine>C:\WINDOWS\system32\srtasks.exe ExecuteScheduledSPPCreation</CommandLine>
      <CommandLine>C:\WINDOWS\system32\dmclient.exe</CommandLine>
      <CommandLine>C:\WINDOWS\system32\sc.exe start wuauserv</CommandLine>
      <CommandLine>C:\WINDOWS\system32\usoclient.exe RefreshSettings</CommandLine>
      <CommandLine>C:\WINDOWS\system32\speech_onecore\common\SpeechModelDownload.exe</CommandLine>
      <CommandLine>C:\WINDOWS\System32\dsregcmd.exe</CommandLine>
      <CommandLine>C:\WINDOWS\CCM\ccmeval.exe</CommandLine>
      <CommandLine>C:\WINDOWS\system32\appidpolicyconverter.exe</CommandLine>
      <CommandLine>C:\WINDOWS\system32\RAServer.exe /offerraupdate</CommandLine>
	  <!-- some of the observed windows default system services -->
	  <CommandLine>c:\windows\system32\svchost.exe -k localsystemnetworkrestricted -s DsSvc</CommandLine>
      <CommandLine>C:\WINDOWS\system32\svchost.exe -k netsvcs -s wisvc</CommandLine>
	  <CommandLine>C:\Windows\system32\svchost.exe -k DcomLaunch</CommandLine>
	  <CommandLine>C:\Windows\system32\svchost.exe -k iissvcs</CommandLine>
      <CommandLine>C:\WINDOWS\system32\svchost.exe -k netsvcs -s wlidsvc</CommandLine>
      <CommandLine>C:\WINDOWS\system32\svchost.exe -k netsvcs -s SCPolicySvc</CommandLine>
      <CommandLine>C:\WINDOWS\system32\svchost.exe -k netsvcs -s DoSvc</CommandLine>
      <CommandLine>C:\WINDOWS\system32\svchost.exe -k netsvcs -s dmwappushservice</CommandLine>
      <CommandLine>c:\windows\system32\svchost.exe -k localsystemnetworkrestricted -s fhsvc</CommandLine>
	  <CommandLine>c:\windows\system32\svchost.exe -k netsvcs -s lfsvc</CommandLine>
	  <CommandLine>c:\windows\system32\svchost.exe -k netsvcs</CommandLine>
	  <Image>C:\Program Files\Oracle\VirtualBox\VBoxSDS.exe</Image>
	  <Image>C:\Program Files\Oracle\VirtualBox\VBoxSVC.exe</Image>
	  <CommandLine>C:\Windows\System32\RuntimeBroker.exe -Embedding</CommandLine> <!-- legit DCOM service child process -->
	  <ParentImage condition="begin with">C:\Program Files\Trend Micro\</ParentImage> 
	  <ParentImage condition="begin with">C:\Program Files (x86)\Trend Micro\</ParentImage> 
	  <ParentImage condition="begin with">C:\Program Files (x86)\Dell\NetVault Backup\</ParentImage> 
	  <Description>Microsoft Distributed Transaction Coordinator Service</Description>
	  <Image>C:\Windows\System32\smartscreen.exe</Image><!-- legit child of svchost -dcomlaunch -->
	  <CommandLine>C:\Windows\system32\DeviceDisplayObjectProvider.exe -Embedding</CommandLine><!-- legit child of DCOM svchost -->
	  <CommandLine>C:\WINDOWS\system32\SppExtComObj.exe -Embedding</CommandLine> <!-- legit child of DCOM svchost -->
	  <CommandLine>C:\WINDOWS\System32\vdsldr.exe -Embedding</CommandLine> <!-- legit child of DCOM svchost -->
	  <CommandLine>C:\Windows\system32\compattel\DiagTrackRunner.exe /UploadEtlFilesOnly</CommandLine>
	  <Image>C:\Windows\System32\slui.exe</Image><!-- legit child or dcomlaunch svchost -->
	  <CommandLine condition="contains">taskhost.exe SYSTEM</CommandLine>
	  <CommandLine>C:\Windows\System32\wsqmcons.exe </CommandLine><!-- legit windows default service -->
	  <CommandLine> C:\Windows\system32\schtasks.exe /delete /f /TN "Microsoft\Windows\Customer Experience Improvement Program\Uploader"</CommandLine><!-- legit schtask default windows execution -->
	  <CommandLine>C:\Windows\System32\VBoxService.exe</CommandLine><!-- legit VBOX service, child of services.exe -->
	  <CommandLine>C:\Windows\system32\svchost.exe -k LocalService</CommandLine><!-- legit service -->
	  <CommandLine>c:\windows\system32\svchost.exe -k localservice -s LicenseManager</CommandLine>
	  <CommandLine>gpupdate.exe /target:user</CommandLine>
	  <CommandLine>"c:\program files\microsoft policy platform\policyhost.exe" /service</CommandLine>
	  <CommandLine>gpupdate.exe /target:computer</CommandLine>
	  <CommandLine>C:\WINDOWS\system32\appidcertstorecheck.exe</CommandLine>
	  <CommandLine>C:\WINDOWS\system32\sc.exe start wuauserv</CommandLine>
	  <CommandLine>"C:\Program Files\Microsoft Data Protection Manager\DPM\bin\DPMRA.exe" -DPMRA</CommandLine>
	  <CommandLine>C:\WINDOWS\system32\svchost.exe -k LocalSystemNetworkRestricted -s NgcSvc</CommandLine>
	  <CommandLine>C:\WINDOWS\system32\svchost.exe -k netsvcs -s wlidsvc</CommandLine>
	  <CommandLine>C:\WINDOWS\system32\svchost.exe -k netsvcs -s dmwappushservice</CommandLine>
	  <CommandLine condition="contains">C:\WINDOWS\CCM\SystemTemp\</CommandLine> <!-- noisy in some env where u will see lot of legit wmi initiated powershell execution via SCCM -->
	  <CommandLine>C:\WINDOWS\SysWOW64\DllHost.exe /Processid:{06622D85-6856-4460-8DE1-A81921B41C4B}</CommandLine> <!-- legit child of svchost -dcomlaunch -->
	  <CommandLine condition="contains">EvaluatePassportCertProfiles</CommandLine><!-- legit system scheduled task runs wmic with this cmdline --> 
	  <CommandLine>C:\Windows\system32\vssvc.exe</CommandLine>
	  <Image>C:\Windows\System32\wbem\WmiPrvSE.exe</Image>
	  <Image>C:\Windows\Sysmon.exe</Image>
	  <Image>C:\Windows\Sysmon64.exe</Image>
	  <Image>C:\Windows\System32\taskhostw.exe</Image>
	  <Image>C:\Windows\System32\taskhost.exe</Image>
	  <Image>C:\Windows\System32\wbem\WmiApSrv.exe</Image>
	  <Image>C:\Windows\Syswow64\wbem\WmiApSrv.exe</Image>
	  <Image>C:\Windows\Syswow64\wbem\WmiPrvSE.exe</Image>
	  <Image condition="begin with">C:\Program Files\HP Inc\</Image>
      <Image condition="end with">C:\Program Files (x86)\Common Files\Adobe\OOBE\PDApp\UWA\updaterstartuputility.exe</Image>
      <Image condition="end with">C:\Program Files (x86)\Common Files\Adobe\Adobe Desktop Common\HEX\Adobe CEF Helper.exe</Image>
      <Image >C:\Windows\System32\audiodg.exe</Image>
      <Image >C:\Program Files\Common Files\Microsoft Shared\ClickToRun\OfficeC2RClient.exe</Image>
      <Image >C:\Program Files (x86)\Microsoft Office\Office16\MSOSYNC.EXE</Image>
      <Image condition="begin with">D:\Program Files\SplunkUniversalForwarder\bin\</Image>
      <Image condition="end with">C:\Program Files (x86)\Common Files\Adobe\AdobeGCClient\AdobeGCClient.exe</Image>
      <Image condition="end with">C:\Program Files (x86)\Common Files\Adobe\OOBE\PDApp\P6\adobe_licutil.exe</Image>
      <Image condition="begin with">C:\Windows\SoftwareDistribution\Download\Install\AM_</Image>
      <Image condition="end with">C:\Program Files (x86)\Common Files\Adobe\OOBE\PDApp\P7\adobe_licutil.exe</Image>
      <Image >C:\Windows\System32\wermgr.exe</Image>
      <Image condition="begin with">D:\Program Files\Splunk\bin\</Image>
      <Image >C:\Windows\System32\MusNotification.exe</Image>
      <Image condition="end with">C:\Program Files (x86)\Dropbox\Update\DropboxUpdate.exe</Image>
      <Image condition="begin with">C:\Program Files\Splunk\bin\</Image>
      <Image >C:\Windows\system32\sppsvc.exe</Image>
      <Image condition="begin with">C:\Program Files\SplunkUniversalForwarder\bin\</Image>
      <Image condition="end with" >C:\Program Files (x86)\Adobe\Acrobat DC\Acrobat\AcroCEF\AcroCEF.exe</Image>
      <Image >C:\Windows\System32\powercfg.exe</Image>
      <Image condition="begin with">C:\Program Files\Windows Defender</Image>
      <Image condition="begin with">C:\Program Files (x86)\Google\Update\</Image>
      <Image >C:\Windows\Microsoft.NET\Framework64\v4.0.30319\mscorsvw.exe</Image>
      <Image condition="end with">C:\Program Files (x86)\Common Files\Adobe\ARM\1.0\armsvc.exe</Image>
      <Image >C:\Windows\Microsoft.NET\Framework\v4.0.30319\mscorsvw.exe</Image>
      <Image condition="begin with">C:\Program Files\Realtek\</Image>
      <Image condition="end with" >C:\Program Files (x86)\Common Files\Adobe\ARM\1.0\AdobeARM.exe</Image>
      <Image condition="end with" >C:\Program Files (x86)\Adobe\Acrobat Reader DC\Reader\AcroCEF\RdrCEF.exe</Image>
      <Image >C:\Windows\Microsoft.Net\Framework64\v3.0\WPF\PresentationFontCache.exe</Image>
      <Image >C:\Windows\System32\conhost.exe</Image>
      <Image condition="end with" >C:\Windows\SysWOW64\Macromed\Flash\FlashPlayerUpdateService.exe</Image>
      <Image >C:\Windows\SysWOW64\wermgr.exe</Image>
      <Image condition="end with" >C:\Program Files (x86)\Adobe\Acrobat DC\Acrobat\AdobeCollabSync.exe</Image>
      <Image condition="begin with" >C:\Program Files\NVIDIA Corporation\</Image>
      <Image condition="end with">C:\Program Files (x86)\Adobe\Adobe Creative Cloud\ACC\Creative Cloud.exe</Image>
      <Image condition="end with">C:\Program Files (x86)\Adobe\Acrobat DC\Acrobat\LogTransport2.exe</Image>
	  <Image condition="begin with">C:\ProgramData\Microsoft\Windows Defender\Platform\</Image>
      <Image>C:\Windows\System32\wbem\WmiApSrv.exe</Image>
      <Image>C:\Windows\system32\MpSigStub.exe</Image>
      <Image>C:\Program Files\Common Files\Microsoft Shared\OfficeSoftwareProtectionPlatform\OSPPSVC.EXE</Image>
      <Image>C:\Windows\System32\MusNotificationUx.exe</Image>
      <Image condition="end with" >C:\Windows\System32\CompatTelRunner.exe</Image>
	  <CommandLine>c:\windows\system32\svchost.exe -k localsystemnetworkrestricted -s fhsvc</CommandLine>
	  <CommandLine>"C:\WINDOWS\System32\Sethc.exe" /AccessibilitySoundAgent</CommandLine>
	  <CommandLine>C:\WINDOWS\system32\sc.exe start w32time task_started</CommandLine>
	  <CommandLine condition="contains">/noconfig /fullpaths @"C:\WINDOWS\</CommandLine><!-- csc.exe noisy cmdline -->
      <CommandLine>C:\Windows\system32\svchost.exe -k netsvcs -s SessionEnv</CommandLine>
	  <ParentCommandLine>c:\windows\system32\svchost.exe -k netsvcs -s TokenBroker</ParentCommandLine>
	  <CommandLine>C:\WINDOWS\system32\svchost.exe -k wsappx -s AppXSvc</CommandLine>
	  <Image>C:\Program Files\Windows Media Player\wmpnetwk.exe</Image>
	  <ParentCommandLine>C:\WINDOWS\system32\svchost.exe -k wsappx -s AppXSvc</ParentCommandLine>
	  <CommandLine>c:\windows\system32\svchost.exe -k localservicenetworkrestricted -s lmhosts</CommandLine>
	  <CommandLine>C:\WINDOWS\system32\svchost.exe -k GPSvcGroup</CommandLine>
      <CommandLine>C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -p -s fhsvc</CommandLine>
	  <CommandLine>C:\Windows\System32\svchost.exe -k LocalServicePeerNet</CommandLine>
      <CommandLine>C:\Windows\system32\SearchIndexer.exe /Embedding</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k networkServiceNetworkRestricted</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k networkService -s LanmanWorkstation</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k netsvcs -s SENS</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k netsvcs -s BITS</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k netsvcs -s CertPropSvc</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k werSvcGroup</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k appmodel</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k networkService -s NlaSvc</CommandLine>
      <CommandLine >C:\WINDOWS\system32\svchost.exe -k netsvcs -p -s wlidsvc</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k dcomlaunch -s PlugPlay</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted -s TimeBrokerSvc</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k netsvcs -s Themes</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k netsvcs -s BDESVC</CommandLine>
      <CommandLine >C:\WINDOWS\system32\svchost.exe -k wsappx -p -s AppXSvc</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k wsappx</CommandLine>
      <CommandLine >C:\WINDOWS\System32\svchost.exe -k LocalSystemNetworkRestricted -p -s WdiSystemHost</CommandLine>
      <CommandLine condition="begin with" >"C:\Program Files (x86)\Google\Chrome\Application\chrome.exe" --type=</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k utcsvc</CommandLine>
      <CommandLine condition="begin with" >C:\Windows\Microsoft.NET\Framework\v4.0.30319\ngen.exe</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s TabletInputService</CommandLine>
      <CommandLine condition="contains" >AcroRd32.exe" /CR </CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k netsvcs -s Winmgmt</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k localService -s bthserv</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s DeviceAssociationService</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k localService -s nsi</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k secsvcs</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k rPCSS</CommandLine>
	  <CommandLine >c:\windows\system32\svchost.exe -k localsystemnetworkrestricted -s SysMain</CommandLine>
	  <ParentCommandLine>c:\windows\system32\svchost.exe -k localsystemnetworkrestricted -s SysMain</ParentCommandLine>
	  <CurrentDirectory>C:\Program Files\Microsoft Data Protection Manager\DPM\bin\</CurrentDirectory>
	  <Description>Background task for Office flighting system</Description>
	  <Description>Visual Studio Background Download</Description>
	  <Description>Windows Modules Installer Worker</Description>
	  <Hashes condition="end with">C9F25CA8397FCBD540480F34D9B3BCEC</Hashes><!-- imphash of Provisioning package runtime processing tool scheduled task -->
	  <Hashes condition="end with">735D544A5E792EDE931E4B8F948CA6AD</Hashes> <!-- imphash of HP MicTray64.exe legit scheduled task -->
	  <Hashes condition="end with">D2F5CF9234015375E0E7947F5C0F4DA1</Hashes> <!-- imphash of legit HP SACpl.exe scheduled task -->
	  <Image>C:\Windows\servicing\TrustedInstaller.exe</Image>
	  <Image>C:\Windows\System32\ApplicationFrameHost.exe</Image>
	  <ParentCommandLine>C:\WINDOWS\System32\svchost.exe -k WerSvcGroup</ParentCommandLine>
	  <CommandLine>C:\WINDOWS\System32\svchost.exe -k WerSvcGroup</CommandLine>
	  <!-- default services.exe child processes -->
	  <CommandLine>C:\WINDOWS\system32\msiexec.exe /V</CommandLine><!-- legit default windows service -->
	  <Hashes condition="contains">44A94FB4C76528D2382FFE04B05827C3</Hashes><!-- MD5 de C:\Windows\servicing\TrustedInstaller.exe-->
	  <CommandLine>taskhost.exe SYSTEM</CommandLine> <!-- legit windows default service - tasks stuff -->
	  <Hashes condition="contains">049933B432D86A4313D712692B1BACC3</Hashes><!-- "C:\Program Files (x86)\Microsoft Office\root\VFS\ProgramFilesCommonX86\Microsoft Shared\Office16\sdxhelper.exe" -->
	  <Image>C:\Windows\System32\LockAppHost.exe</Image>  
      <CommandLine >C:\WINDOWS\system32\svchost.exe -k appmodel -p -s tiledatamodelsvc</CommandLine>
      <CommandLine>C:\Windows\system32\svchost.exe -k localService -s EventSystem</CommandLine>
      <CommandLine>C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -p -s WPDBusEnum</CommandLine>
      <CommandLine>C:\Windows\system32\svchost.exe -k networkService -s TermService</CommandLine>
      <CommandLine>C:\Windows\system32\svchost.exe -k netsvcs -s ProfSvc</CommandLine>
      <CommandLine condition="begin with" >"C:\Program Files\Google\Chrome\Application\chrome.exe" --type=</CommandLine>
      <CommandLine>C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted -s EventLog</CommandLine>
      <CommandLine>C:\Windows\system32\svchost.exe -k localServiceAndNoImpersonation -s SensrSvc</CommandLine>
      <CommandLine>C:\Windows\system32\svchost.exe -k camera -s FrameServer</CommandLine>
      <CommandLine condition="contains" >AcroRd32.exe" --channel=</CommandLine>
      <CommandLine condition="begin with" >"C:\Program Files (x86)\Mozilla Firefox\plugin-container.exe" --channel</CommandLine>
      <CommandLine>C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s SensorService</CommandLine>
      <CommandLine>C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted -s Dhcp</CommandLine>
      <CommandLine>C:\Windows\system32\svchost.exe -k netsvcs -p -s ncaSvc</CommandLine>
      <CommandLine>C:\Windows\system32\svchost.exe -k localService -s w32Time</CommandLine>
      <CommandLine>C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s WdiSystemHost</CommandLine>
      <CommandLine>C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s NcbService</CommandLine>
      <CommandLine>C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted -s WFDSConMgrSvc</CommandLine>
      <CommandLine condition="begin with" >"C:\Program Files\Mozilla Firefox\plugin-container.exe" --channel</CommandLine>
      <CommandLine>C:\Windows\system32\svchost.exe -k defragsvc</CommandLine>
      <CommandLine>C:\Windows\system32\svchost.exe -k swprv</CommandLine>
      <CommandLine>C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s WPDBusEnum</CommandLine>
      <CommandLine>C:\Windows\system32\svchost.exe -k dcomlaunch -s LSM</CommandLine>
      <CommandLine>C:\Windows\system32\svchost.exe -k wsappx -s ClipSVC</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k networkService</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k netsvcs -s DsmSvc</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k networkService -s Dnscache</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted -s UmRdpService</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k localServiceNoNetwork</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k netsvcs -s Gpsvc</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k appmodel -s StateRepository</CommandLine>
      <CommandLine >C:\WINDOWS\System32\svchost.exe -k wsappx -p -s ClipSVC</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k imgsvc</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k devicesflow -s DevicesFlowUserSvc</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k wbioSvcGroup</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k unistackSvcGroup</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k localServiceNetworkRestricted</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k networkService -p -s DoSvc</CommandLine>
      <CommandLine >C:\Windows\system32\svchost.exe -k localServiceAndNoImpersonation</CommandLine>
      <IntegrityLevel>AppContainer</IntegrityLevel>
      <ParentImage >C:\Program Files (x86)\Common Files\Adobe\OOBE\PDApp\UWA\updaterstartuputility.exe</ParentImage>
      <ParentImage >D:\Program Files\SplunkUniversalForwarder\bin\splunk.exe</ParentImage>
      <ParentImage condition="end with" >C:\Program Files (x86)\Adobe\Adobe Creative Cloud\CoreSync\CoreSync.exe</ParentImage>
      <ParentImage >C:\Windows\Microsoft.NET\Framework64\v4.0.30319\mscorsvw.exe</ParentImage>
      <ParentImage condition="end with" >C:\Program Files (x86)\Common Files\Adobe\AdobeGCClient\AGSService.exe</ParentImage>
      <ParentImage condition="end with" >C:\Program Files (x86)\Common Files\Adobe\OOBE\PDApp\P7\adobe_licutil.exe</ParentImage>
      <ParentImage condition="end with" >C:\Program Files (x86)\Cisco\Cisco AnyConnect Secure Mobility Client\vpnagent.exe</ParentImage>
      <ParentImage >C:\Windows\Microsoft.NET\Framework64\v4.0.30319\ngentask.exe</ParentImage>
      <ParentImage >D:\Program Files\Splunk\bin\splunkd.exe</ParentImage>
      <ParentImage >C:\Program Files\Common Files\Microsoft Shared\ClickToRun\OfficeC2RClient.exe</ParentImage>
      <ParentImage condition="end with" >C:\Program Files (x86)\Common Files\Adobe\ARM\1.0\AdobeARM.exe</ParentImage>
      <ParentImage >C:\Program Files\SplunkUniversalForwarder\bin\splunk.exe</ParentImage>
      <ParentImage >D:\Program Files\SplunkUniversalForwarder\bin\splunkd.exe</ParentImage>
      <ParentImage >C:\Windows\Microsoft.NET\Framework\v4.0.30319\mscorsvw.exe</ParentImage>
      <ParentImage condition="end with">C:\Program Files (x86)\Dropbox\Update\DropboxUpdate.exe</ParentImage>
      <ParentImage condition="end with">C:\Program Files (x86)\Adobe\Adobe Creative Cloud\ACC\Creative Cloud.exe</ParentImage>
      <ParentImage condition="end with">C:\Program Files (x86)\Adobe\Adobe Creative Cloud\CCXProcess\CCXProcess.exe</ParentImage>
      <ParentImage >C:\Program Files\Splunk\bin\splunkd.exe</ParentImage>
      <ParentImage >C:\Program Files\SplunkUniversalForwarder\bin\splunkd.exe</ParentImage>
      <ParentImage condition="end with">C:\Program Files\Realtek\Audio\HDA\RtkAudioService64.exe</ParentImage>
      <ParentImage >C:\Windows\Microsoft.NET\Framework\v4.0.30319\ngentask.exe</ParentImage>
      <ParentImage condition="end with">C:\Program Files\Common Files\Microsoft Shared\ClickToRun\OfficeClickToRun.exe</ParentImage>
      <ParentImage >C:\Windows\system32\SearchIndexer.exe</ParentImage>
      <ParentImage condition="begin with">C:\Program Files (x86)\Google\Update\</ParentImage>
      <ParentCommandLine condition="begin with">%%SystemRoot%%\system32\csrss.exe ObjectDirectory=\Windows</ParentCommandLine>
      <ParentCommandLine condition="contains">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\ngentask.exe</ParentCommandLine>
      <ParentCommandLine>C:\Windows\system32\svchost.exe -k netsvcs</ParentCommandLine>
      <ParentCommandLine>C:\Windows\system32\svchost.exe -k localSystemNetworkRestricted</ParentCommandLine>
    </ProcessCreate>
	
<!--
File Creattion Time 
-->
	
    <FileCreateTime onmatch="include">
      <Image condition="begin with">C:\Users</Image>
      <Image condition="begin with">C:\Temp</Image>
      <Image condition="begin with">C:\Windows\Temp</Image>
      <Image condition="begin with">C:\Tmp</Image>
    </FileCreateTime>
	
	<!-- FileCreateTime - Exclusion Section -->
    
	<FileCreateTime onmatch="exclude">
	  <Image condition="begin with">C:\Program Files (x86)\Trend Micro\</Image>
	  <Image condition="begin with">C:\Program Files\Trend Micro\</Image>
      <Image condition="image">OneDrive.exe</Image>
      <Image condition="contains">setup</Image>
    </FileCreateTime>
	
<!--
Network Connect
-->
    <NetworkConnect onmatch="include">
      <!-- NetworkConnect - LOLBIN -->
      <Image condition="image">wscript.exe</Image>
	  <Image condition="image">explorer.exe</Image> 
      <Image condition="image">vnc.exe</Image>
      <Image condition="image">dsquery.exe</Image>
      <Image condition="image">notepad.exe</Image>
	  <Image>rdpclip.exe</Image>
      <Image condition="image">SyncAppvPublishingServer.exe</Image>
      <Image condition="image">certutil.exe</Image>
	  <Image condition="image">wmic.exe</Image>
      <Image condition="image">nbtstat.exe</Image>
      <Image condition="image">bitsadmin.exe</Image>
      <Image condition="image">msiexec.exe</Image>
      <Image condition="image">infDefaultInstall.exe</Image>
      <Image condition="image">winexesvc.exe</Image>
      <Image condition="image">sc.exe</Image>
      <Image condition="image">Mavinject.exe</Image>
      <Image condition="image">omniinet.exe</Image>
      <Image condition="image">hpsmhd.exe</Image>
      <Image condition="image">javaws.exe</Image>
      <Image condition="image">reg.exe</Image>
      <Image condition="image">net.exe</Image>
	  <Image condition="image">net1.exe</Image>
      <Image condition="image">vncservice.exe</Image>
      <Image condition="image">schtasks.exe</Image>
	  <Image condition="image">mstsc.exe</Image><!-- Remote Desktop -->
      <Image condition="image">qprocess.exe</Image>
      <Image condition="image">rwinsta.exe</Image>
      <Image condition="image">nslookup.exe</Image>
      <Image condition="image">mmc.exe</Image>
      <Image condition="image">tasklist.exe</Image>
      <Image condition="image">net1.exe</Image>
      <Image condition="image">cscript.exe</Image>
      <Image condition="image">qwinsta.exe</Image>
      <Image condition="image">psexesvc.exe</Image>
      <Image condition="image">at.exe</Image>
      <Image condition="image">replace.exe</Image>
      <Image condition="image">tor.exe</Image>
      <Image condition="image">powershell.exe</Image>
      <Image condition="image">psexec.exe</Image>
      <Image condition="image">rundll32.exe</Image>
      <Image condition="image">regsvcs.exe</Image>
      <Image condition="image">driverquery.exe</Image>
      <Image condition="image">mshta.exe</Image>
      <Image condition="image">msbuild.exe</Image>
      <Image condition="image">vncviewer.exe</Image>
      <Image condition="image">cmd.exe</Image>
      <Image condition="image">javaw.exe</Image>
      <Image condition="image">regsvr32.exe</Image>
      <Image condition="image">taskkill.exe</Image>
      <Image condition="image">hh.exe</Image>
	  <Image condition="image">schtasks.exe</Image>
	  <Image condition="image">installutil.exe</Image>
	  
	  <Image>C:\Windows\System32\inetsrv\w3wp.exe</Image><!-- noisy for 8080 -->
	  <Image>C:\Windows\SysWOW64\inetsrv\w3wp.exe</Image>
      <!-- NetworkConnect - Suspicious Paths -->
      <Image condition="begin with">C:\Windows\Media\</Image>
      <Image condition="begin with">C:\Windows\addins\</Image>
	  <Image condition="begin with">C:\Windows\system32\config\systemprofile\</Image>
	  <Image condition="begin with">C:\Windows\Debug\</Image> 
	  <Image condition="begin with">C:\Windows\Temp</Image>
      <Image condition="begin with">C:\PerfLogs\</Image>
	  <Image condition="begin with">C:\Windows\Help\</Image>
	  <Image condition="begin with">C:\Intel\Logs\</Image>
	  <Image condition="begin with">C:\Temp</Image>
      <Image condition="begin with">C:\Windows\repair\</Image>
	  <Image condition="begin with">C:\ProgramData</Image>
      <Image condition="begin with">C:\Windows\security\</Image>
      <Image condition="begin with">C:\Windows\Fonts\</Image>
      <Image condition="contains">\wwwroot\</Image>
	  <Image condition="contains">\htdocs\</Image>
	  <Image condition="begin with">C:\$Recycle.bin\</Image>
	  <Image condition="contains">\Windows\IME\</Image>
	  <Image condition="contains">unknown process</Image>
      <!-- NetworkConnect - Known Port Numbers that are relevant for some lateral movement and traffic tunneling techniques -->
      <DestinationPort>5986</DestinationPort><!-- PS remoting, WinRM HTTPS -->
	  <DestinationPort>5985</DestinationPort><!-- PS remoting, WinRM HTTP -->
	  <DestinationPort>445</DestinationPort> <!-- smb -->
	  <SourcePort>445</SourcePort> <!-- smb -->
	  <DestinationPort>139</DestinationPort> <!-- nbns -->
	  <DestinationPort>389</DestinationPort> <!-- ldap -->
	  <DestinationPort>636</DestinationPort> <!-- ldaps -->
	  <DestinationPort>3268</DestinationPort> <!-- msft-gc -->
	  <DestinationPort>3269</DestinationPort> <!-- msft-gc -->
	  <DestinationPort>53</DestinationPort> <!-- dns exfilt, dns.exe noisy -->
	  <DestinationPort>5353</DestinationPort> <!-- dns exfilt -->
	  <DestinationPort>464</DestinationPort> <!-- keberos passwords changes -->
	  <!--<DestinationPort>80</DestinationPort>
	  <DestinationPort>443</DestinationPort>
	  <DestinationPort>8443</DestinationPort> too noisy ports -->
	  <DestinationPort condition="is">135</DestinationPort> <!-- rcp -->
	  <DestinationPort condition="is">20</DestinationPort> <!--FTP data-->
	  <DestinationPort condition="is">21</DestinationPort> <!--FTP control-->
	  <DestinationPort condition="is">990</DestinationPort> <!--FTPS-->
	  <DestinationPort condition="is">22</DestinationPort> <!--SSH -->
	  <DestinationPort condition="is">23</DestinationPort> <!--Telnet-->
	  <DestinationPort condition="is">25</DestinationPort> <!--SMTP -->
	  <DestinationPort condition="is">142</DestinationPort> <!--IMAP-->
	  <DestinationPort condition="is">3389</DestinationPort> <!--RDP-->
	  <SourcePort condition="is">3389</SourcePort><!--RDP-->
	  <SourcePort condition="is">67</SourcePort><!-- dhcp server side- detect rogue dhcp server  -->
	  <SourcePort condition="is">547</SourcePort><!-- dhcp ipv6 server side - detect rogue dhcp server -->
	  <DestinationPort condition="is">5800</DestinationPort> <!--VNC -->
	  <DestinationPort condition="is">5900</DestinationPort> <!--VNC -->
	  <!--Ports: Proxy-->
	  <DestinationPort condition="is">1080</DestinationPort> <!--Socks proxy port | Credit @ion-storm-->
	  <DestinationPort condition="is">3128</DestinationPort> <!--Socks proxy port - noisy with lsass.exe | Credit @ion-storm-->
	  <DestinationPort condition="is">8080</DestinationPort> <!--Socks proxy port | Credit @ion-storm-->
	  <!--Ports: Tor-->
	  <DestinationPort condition="is">1723</DestinationPort> <!--Tor protocol-->
	  <DestinationPort condition="is">4500</DestinationPort> <!--Tor protocol-->
	  <DestinationPort condition="is">9001</DestinationPort> <!--Tor protocol-->
	  <DestinationPort condition="is">9030</DestinationPort> <!--Tor protocol-->
	  <!-- for known bad port numbers see https://github.com/Neo23x0/sigma/blob/master/rules/windows/sysmon/sysmon_malware_backconnect_ports.yml -->
	  
	  <!-- some of the many domain Malware uses to get external IP address, better look at your dns logs or traffic-->
	  <DestinationHostname>api.ipify.org</DestinationHostname> 
	  <DestinationHostname>whatismyipaddress.com</DestinationHostname>
	  <DestinationHostname>edns.ip-api.com</DestinationHostname> 
	  <DestinationHostname>checkip.dyndns.org</DestinationHostname>
	  <DestinationHostname>icanhazip.com</DestinationHostname>
	  <DestinationHostname>ifconfig.me</DestinationHostname>
	  <DestinationHostname>ifconfig.co</DestinationHostname>
	  <DestinationHostname>ipaddress.com</DestinationHostname> 
	  <DestinationHostname>ipinfo.io</DestinationHostname>
	  <DestinationHostname>ident.me</DestinationHostname>
	  <DestinationHostname>api.ip.sb</DestinationHostname> <!--Malware uses to get external IP address-->
	  <DestinationHostname>www.myexternalip.com</DestinationHostname> <!--Malware uses to get external IP address-->
	  <DestinationHostname>ip.anysrc.net</DestinationHostname> <!--Malware uses to get external IP address-->
	  <DestinationHostname>wtfismyip.com</DestinationHostname> <!--Malware uses to get external IP address-->
	  <DestinationHostname>myexternalip.com</DestinationHostname> <!--Malware uses to get external IP address-->
	  <DestinationHostname>api.ip.sb</DestinationHostname> <!--Malware uses to get external IP address-->
	  <DestinationHostname>ipecho.net</DestinationHostname> <!--Malware uses to get external IP address-->
	  <DestinationHostname>checkip.amazonaws.com</DestinationHostname>
	  <DestinationHostname>ip-api.com</DestinationHostname>
    </NetworkConnect>
	
<!-- NetworkConnect - Exclusion Section - depend on your own env exclude noisy processes paths and users-->

    <NetworkConnect onmatch="exclude">
	  <Image>C:\Windows\System32\dns.exe</Image><!-- noisy for dns -->
	  <Image>C:\Windows\System32\svchost.exe</Image><!-- noisy for dns and ldap -->
	  <Image>C:\Windows\System32\lsass.exe</Image><!-- noisy for ldap -->
	  <Image>C:\Windows\System32\dfsrs.exe</Image><!-- noisy for ldap -->
	  <Image>C:\Windows\System32\taskhost.exe</Image><!-- noisy for ldap -->
	  <Image>C:\Windows\System32\wbem\WmiPrvSE.exe</Image><!-- noisy for ldap -->
	  <Image>C:\Windows\System32\wbem\WmiApSrv.exe</Image><!-- noisy for ldap -->
	  <Image>C:\Windows\System32\taskhostw.exe</Image><!-- noisy for ldap -->
	  <Image>C:\Windows\CCM\CcmExec.exe</Image>
	  <Image>C:\Windows\ADWS\Microsoft.ActiveDirectory.WebServices.exe</Image><!-- noisy for ldap -->
	  <Image>C:\Program Files (x86)\BigFix Enterprise\BES Client\BESClient.exe</Image><!-- noisy for ldap -->
	  <Image>C:\Program Files (x86)\Google\Chrome\Application\chrome.exe</Image><!-- noisy for 5353 MDNS -->
	  <Image>C:\Windows\System32\dfssvc.exe</Image><!-- noisy for ldap -->
	  <Image>C:\Windows\System32\dsregcmd.exe</Image><!-- noisy for ldap -->
	  <Image>C:\Program Files\Oracle\VirtualBox\VirtualBoxVM.exe</Image>
	  <Image>C:\Windows\System32\certsrv.exe</Image>
	  
	  <Image>C:\Program Files (x86)\Trend Micro\Control Manager\ReportServer.exe</Image>
	  <Image>C:\Program Files (x86)\Citrix\XenCenter\XenCenterMain.exe</Image>
	  <Image>C:\Program Files (x86)\Cisco\Cisco AnyConnect Secure Mobility Client\vpnagent.exe</Image>
	  <Image>C:\Program Files (x86)\BigFix Enterprise\BES Server\BESRootServer.exe</Image>
	  <Image>C:\Program Files (x86)\Trend Micro\Control Manager\CmdProcessor.exe</Image>
	  <Image>D:\Program Files (x86)\Symantec\LiveUpdate Administrator\pgsql\bin\postgres.exe</Image>
	  <User>NT AUTHORITY\NETWORK SERVICE</User>
	  <User>NT AUTHORITY\LOCAL SERVICE</User>
	  <DestinationIsIpv6 condition="is">true</DestinationIsIpv6> 	  
      <Image condition="end with">OneDriveStandaloneUpdater.exe</Image>
	  <Image condition="end with">iexplore.exe</Image>
	  <Image condition="end with">firefox.exe</Image>
	  <Image condition="end with">MicrosoftEdgeCP.exe</Image>
	  <Image condition="end with">MicrosoftEdge.exe</Image>
	  <Image condition="end with">GoogleCrashHandler.exe</Image>
	  <Image condition="end with">Spotify.exe</Image>
	  <Image condition="end with">java.exe</Image><!-- noise signal depend on ur env -->
	  <Image condition="end with">AppData\Roaming\Dropbox\bin\Dropbox.exe</Image>
	  <Image condition="end with">AppData\Local\Microsoft\Teams\current\Teams.exe</Image>
	  <Image condition="begin with">C:\Program Files\HP Inc\</Image>
	  <Image condition="begin with">C:\Program Files (x86)\Trend Micro\</Image>
	  <Image condition="begin with">C:\Program Files\Trend Micro\</Image>
	  <Image condition="begin with">C:\Program Files\Microsoft Office\root\</Image>
	  <Image condition="begin with">C:\Program Files (x86)\Symantec\Symantec Endpoint Protection\</Image>
    </NetworkConnect>
<!--
Process Terminate    
-->

    <ProcessTerminate onmatch="include">
      <Image condition="begin with" >C:\Users</Image>
      <Image condition="begin with" >C:\Temp</Image>
      <Image condition="begin with" >C:\Windows\Temp</Image>
    </ProcessTerminate>
</EventFiltering>
</Sysmon>

<!--
End of File 1, to be continue ...    
-->